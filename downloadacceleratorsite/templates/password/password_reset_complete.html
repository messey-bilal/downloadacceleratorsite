{% extends "admin/passwordbase.html" %}
{% load i18n %}


{% block content %}

<div class="container">
    <div class="row g-5 p-4">
      <div class="col-sm-12 col-lg-6">
        <div class="p-3">
          <h2>{% translate 'Password reset' %}</h2>
          <p>{% translate "Your password has been set.  You may go ahead and log in now." %}</p>
          <p><a id="idlink" data-bs-toggle="modal" data-bs-target="#modal-connexion" href="{% url 'downloadaccelerator:modalconnexion' %}">{% translate 'Log in' %}</a></p>

          <div class="modal fade" id="modal-connexion" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
              <div class="modal-content" id="modal-content-connexion">
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
</div>

{% endblock content %}

{% block js %}
<script>
$(function(){

    $('#idlink').click(
      function(){
        $('#modal-content-connexion').load(
          "{% url 'downloadaccelerator:modalconnexion' 'reset' %}",function(){
            $('#modal-connexion').modal('show');
          }
        );
      }
    ); 

    /**
     * management of password button
     */
    $('.fa-eye-slash').click(
      function () {
        var newType = $(this).siblings('input').attr('type') === 'password' ? 'text' : 'password';
        $(this).siblings('input').attr('type', newType);
        $(this).toggleClass('fa-eye-slash').toggleClass('fa-eye');
      }
    );
    

    /* click on button which gives access to forums */
    $('#forumModal').click(
      function(){
        $('#welcome').modal('toggle');
        window.open('forums/','_self');
      }
    );
    
        /* click on connexion button */
    $('#connexionButton').click(
        function(){
          
          var emptyName = ($('#connexionName').val().length === 0) ? true : false;
          var emptyPassword = ($('#connexionPassword').val().length === 0) ? true : false;
          var warn = 'This field must not be empty';
          
          if(!emptyName && !emptyPassword){
            if(userAuth($('#connexionForm'))){
              $('#modal-connexion').modal('toggle');
              $("#welcomemessage").html($('#connexionName').val() + " welcome to forums");
              $('#welcome').modal('show');
            }
            else{
              $('#connexionName').tooltip('enable').tooltip('show');
              $('#connexionPassword').val('');
              $('#connexionPassword').focus();
              filledInput($('#connexionPassword'), $('#passwordDanger'));
            }
          }
          else if(emptyName && emptyPassword){
            dangerInput($('#connexionName'), $('#nameDanger'), $('#nameDanger small'), warn);
            dangerInput($('#connexionPassword'), $('#passwordDanger'), $('#passwordDanger small'), warn);
            $('#connexionName').tooltip('disable');
          }
          else if(emptyName && !emptyPassword){
            dangerInput($('#connexionName'), $('#nameDanger'), $('#nameDanger small'), warn);
            filledInput($('#connexionPassword'), $('#passwordDanger'));
            $('#connexionName').tooltip('disable');
          }
          else if(!emptyName && emptyPassword){
            dangerInput($('#connexionPassword'), $('#passwordDanger'), $('#passwordDanger small'), warn);
            filledInput($('#connexionName'), $('#nameDanger'));
            $('#connexionName').tooltip('disable');
          }
        }
    );


    function userAuth(connexionForm){
      var ret = false;
      var serializedData = connexionForm.serialize();
      $.ajax({
        async: false,
        type: 'POST',
        url: "{% url 'downloadaccelerator:userauth' %}",
        data: serializedData,
        success: function(response){
          if(response["auth"]){
            ret = true;
          }
        }
      });
      return ret;
    }


    function dangerInput(objectInput, objectNotice, objectWarning, warning){
      if(!objectInput.hasClass('border-danger')){
        objectInput.addClass('border-danger');
      }
      if(!objectNotice.hasClass('text-danger')){
        objectNotice.removeClass('text-white');
        objectNotice.addClass('text-danger');
      }
      objectWarning.html(warning);
    }

    function filledInput(objectInput, objectNotice){
      if(objectInput.hasClass('border-danger')){
        objectInput.removeClass('border-danger');
      }
      if(objectNotice.hasClass('text-danger')){
        objectNotice.removeClass('text-danger');
        objectNotice.addClass('text-white');
      }
    }

});
</script>
{% endblock js %}
